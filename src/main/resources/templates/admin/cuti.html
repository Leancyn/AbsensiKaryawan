<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  th:replace="layout/admin-layout :: layout(
    title='Pengajuan Cuti',
    menu='cuti',
    content=~{::content}
  )"
>
  <th:block th:fragment="content">
    <div class="page-header mb-3">
      <h4 class="page-title">Pengajuan Cuti Karyawan</h4>
    </div>

    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>User</th>
                <th>Periode</th>
                <th>Alasan</th>
                <th>Status</th>
                <th class="text-end">Aksi</th>
              </tr>
            </thead>
            <tbody id="cutiBody">
              <tr>
                <td colspan="6" class="text-center text-muted">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- SCRIPT WAJIB DI DALAM FRAGMENT -->
    <script>
      async function loadCuti() {
        try {
          const res = await fetch("/api/cuti/pending");
          const data = await res.json();

          const body = document.getElementById("cutiBody");
          body.innerHTML = "";

          if (data.length === 0) {
            body.innerHTML = `
              <tr>
                <td colspan="6" class="text-center text-muted">
                  Tidak ada pengajuan cuti
                </td>
              </tr>
            `;
            return;
          }

          data.forEach((c) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${c.id}</td>
              <td>${c.userId}</td>
              <td>${c.tanggalMulai} â†’ ${c.tanggalSelesai}</td>
              <td>${c.alasan}</td>
              <td>
                <span class="badge bg-warning">PENDING</span>
              </td>
              <td class="text-end">
                <button class="btn btn-success btn-sm"
                  onclick="updateCuti(${c.id}, 'approve')">
                  Approve
                </button>
                <button class="btn btn-danger btn-sm"
                  onclick="updateCuti(${c.id}, 'reject')">
                  Reject
                </button>
              </td>
            `;
            body.appendChild(tr);
          });
        } catch (err) {
          alert("Gagal load data cuti");
          console.error(err);
        }
      }

      async function updateCuti(id, action) {
        const res = await fetch(`/api/cuti/${id}/${action}`, {
          method: "POST",
        });
        if (res.ok) loadCuti();
        else alert("Gagal update cuti");
      }

      loadCuti();
    </script>
  </th:block>
</html>
