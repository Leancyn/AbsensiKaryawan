<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Login Absensi</title>
    <style>
      body {
        font-family: Arial;
        text-align: center;
        padding: 50px;
        background: #f0f0f0;
      }
      #loginForm {
        background: white;
        padding: 20px;
        border-radius: 8px;
        display: inline-block;
      }
      input {
        margin: 5px;
        padding: 8px;
        width: 200px;
      }
      button {
        padding: 10px 20px;
        margin-top: 10px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="loginForm">
      <h2>Login Absensi</h2>
      <input type="text" id="nip" placeholder="NIP" /><br />
      <input type="password" id="password" placeholder="Password" /><br />
      <button id="loginBtn">Login</button>
      <p id="loginMsg" style="color: red"></p>
    </div>

    <script>
      document.getElementById("loginBtn").addEventListener("click", async () => {
        const nip = document.getElementById("nip").value;
        const password = document.getElementById("password").value;

        if (!nip || !password) {
          document.getElementById("loginMsg").innerText = "Isi NIP & Password";
          return;
        }

        const res = await fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nip, password }),
        });

        const data = await res.json();

        if (data.success) {
          // Simpan sessionStorage
          sessionStorage.setItem("userId", data.userId);
          sessionStorage.setItem("userNama", data.userNama);
          sessionStorage.setItem("userRole", data.role);

          // Redirect sesuai role
          if (data.role === "ADMIN") {
            window.location.href = "/admin/dashboard"; // halaman admin
          } else if (data.role === "USER") {
            window.location.href = "/dashboard"; // halaman karyawan
          } else {
            document.getElementById("loginMsg").innerText = "Role tidak dikenali";
          }
        } else {
          document.getElementById("loginMsg").innerText = data.message;
        }
      });
    </script>
  </body>
</html>
